{% load static %}
<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cabriot KDS</title>
    <!-- Add your CSS, Bootstrap, and other head elements here -->
    <!-- Include Masonry.js from CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"></script>
</head>
<style>
.navbar-brand {
        font-size: 2rem;
        font-weight: bold;
    }

    .navbar {
        height: 56px;
        padding: 0;
    }
    .container, .p-5.my-3 {
    padding: 0;
    margin: 0;
    }
    body {
    padding-top: 0;
    padding-left: 0;
    padding-right: 0;
    }
/* Navbar Styling */
.navbar-brand {
    font-size: 2rem;
    font-weight: bold;
}

.navbar {
    height: 56px;
    padding: 0;
}

.container, .p-5.my-3 {
    padding: 0;
    margin: 0;
}

body {
    padding-top: 0;
    padding-left: 0;
    padding-right: 0;
}

/* Masonry Grid: Ensure masonry layout behaves responsively */
#masonry-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px; /* More spacing between grid items for clarity */
}

/* Card Styling */
.card {
    border: 1px solid #ddd;  /* Light border */
    border-radius: 0.5rem;    /* Rounded corners */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);  /* Soft shadow */
    overflow: hidden;  /* Prevent overflow of card content */
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

/* Hover effect on cards */
.card:hover {
    transform: translateY(-5px);  /* Slight lift effect */
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);  /* Enhanced shadow on hover */
}

/* Card Header */
.card-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #ddd;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Flexbox for content alignment */
.card-header .d-flex {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-header .d-flex.flex-column {
    flex-direction: column;
}

.card-body {
    padding: 1rem;
    background-color: #fff;
}

/* Table Styling inside card */
.table {
    margin-bottom: 0;
    font-size: 0.9rem;
}

.table th, .table td {
    text-align: center;
    padding: 0.5rem;
}

/* Badge Styling */
.badge {
    font-size: 0.875rem;
    font-weight: bold;
    text-transform: uppercase;
}

/* Badge Colors */
.bg-success {
    background-color: #28a745 !important;
}
.bg-danger {
    background-color: #dc3545 !important;
}
.bg-warning {
    background-color: #ffc107 !important;
}

/* Count Section Styling */
.text-center mt-2 p {
    font-size: 1rem;
    font-weight: bold;
}

/* Responsive Grid - Media Queries */
@media (max-width: 576px) {
    .card {
        margin-bottom: 15px;  /* Add spacing between cards on mobile */
    }
}

@media (max-width: 768px) {
    .card-header {
        flex-direction: column;
        align-items: flex-start;
    }

    .card-header .text-end {
        text-align: left;
    }
}

@media (min-width: 992px) {
    .card-header {
        flex-direction: row;
        align-items: center;
    }

    .card-header .text-end {
        text-align: right;
    }
}



</style>
<body>
    <!-- Navbar and other header content -->
<header>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top p-5">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <!-- Left Section: Logo and Title -->
            <div class="d-flex align-items-center">
                <img src="{% static 'image/cabriot_Orderlogo.png' %}" alt="Logo" class="me-3">
                <h2 class="navbar-brand mb-0 fs-1 text-white">Orders</h2>
            </div>
            <!-- Right Section: Date and Last Updated Time -->
            <div class="d-flex align-items-center ms-auto">
              <div class="text-end text-white">
                <p class="mb-0"><strong>{{ current_date|date:"l, F j, Y" }}</strong></p>
                <p class="mb-0 fs-5">{{ current_time }}</p>
                <small class="mb-0 fs-8">Last Updated 30 minutes ago</small>
              </div>
            </div>
        </div>
    </nav>
</header>

<div class="container my-2 p-4">
    <!-- Masonry Grid Layout -->
    <div id="masonry-container" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
        {% for order in orders %}
            <div class="col">
                <div class="card shadow-sm border-light rounded-3">
                    <!-- Card Header -->
                    <div class="card-header d-flex justify-content-between align-items-center p-3">
                        <div class="text-start">
                            <h6 class="mb-0 fw-bold">{{ order.client__name|title }}</h6>
                        </div>
                        <div class="text-end">
                            <span class="badge custom-badge
                                {% if order.order_status == 'Cooking' %} bg-success
                                {% elif order.order_status == 'Dispatched' %} bg-primary
                                {% elif order.order_status == 'Ready' %} bg-info
                                {% else %} bg-warning
                                {% endif %}">
                                {{ order.order_status }}
                            </span>
                        </div>
                    </div>

                    <!-- Card Body -->
                    <div class="card-body p-2">
                        <div class="table-responsive">
                            <table class="table table-bordered mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="text-center align-middle" style="padding: 0.5rem;">
                                            {{ order.meal_type }}
                                        </th>
                                        <th class="text-center text-muted small align-middle" style="padding: 0.5rem;">
                                            Order #: {{ order.order_number }}
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% with items_json|dictsort:"order_id" as sorted_items %}
                                        {% for item in sorted_items %}
                                            {% if item.order_id == order.id %}
                                                <tr>
                                                    <td class="text-center py-1 align-middle">
                                                        <strong>{{ item.item__item_name }}</strong>
                                                    </td>
                                                    <td class="text-center py-1 align-middle">
                                                        {{ item.quantity|default:"0" }}
                                                        {% if item.quantity_type %}
                                                            {% if item.quantity_type == 'kilogram' %} Kg
                                                            {% elif item.quantity_type == 'Numbers' %} Nos
                                                            {% elif item.quantity_type == 'grams' %} G
                                                            {% else %} {{ item.quantity_type }}
                                                            {% endif %}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                    {% endwith %}
                                    <!-- COUNT row -->
                                    <tr>
                                        <td colspan="2" class="text-center fw-bold py-2">
                                            COUNT: <span>{{ order.total_pax_quantity|default:" " }}</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>





<!-- Additional CSS for Card Styling -->
<!--<style>-->
<!--    .order-card-item .card {-->
<!--        height: 100%; /* Ensures cards stretch to fill columns in each row */-->
<!--    }-->
<!--    #masonry-container {-->
<!--        display: flex;-->
<!--        flex-wrap: wrap;-->
<!--    }-->
<!--</style>-->


<div id="orders" hidden data-orders="{{ orders|json_script:'ordersData' }}"></div>
<!--<div id="items-data" data-items='{{ items_json|escapejs }}'></div>-->
<div id="items-data" data-items='{{ items_json|escapejs }}'></div>


<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

    <!-- Main Content Section -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer Section (optional) -->
    <footer>
        <!-- Add footer content here -->
    </footer>

    <!-- JavaScript includes (e.g., Bootstrap JS, your custom JS) -->
    <script>
        // Initialize Masonry after the page loads
<!--        document.addEventListener('DOMContentLoaded', function () {-->
<!--            var masonryGrid = document.querySelector('#masonry-container');-->
<!--            if (masonryGrid) {-->
<!--                new Masonry(masonryGrid, {-->
<!--                    itemSelector: '.col',  // The element you want to arrange-->
<!--                    columnWidth: '.row',   // The width of each column-->
<!--                    percentPosition: true,        // Ensures proper position calculations-->
<!--                    gutter: 20                    // Space between items-->
<!--                });-->
<!--            }-->
<!--        });-->
<!--        document.addEventListener('DOMContentLoaded', function () {-->
<!--    var masonryGrid = document.querySelector('#masonry-container');-->
<!--    if (masonryGrid) {-->
<!--        new Masonry(masonryGrid, {-->
<!--            itemSelector: '.col',-->
<!--            columnWidth: '.row',-->
<!--            percentPosition: true,-->
<!--            gutter: 20-->
<!--        });-->
<!--    } else {-->
<!--        console.error('Masonry container not found');-->
<!--    }-->
<!--    });-->
    document.addEventListener("DOMContentLoaded", function() {
        // Example API call to fetch order and item data (this could be replaced with your actual data source)
        fetch('/view/')
            .then(response => response.json())
            .then(data => {
                console.log("",data)
                const orders = data.orders; // Replace with actual data structure from your API
                const items = data.items;   // Replace with actual data structure from your API
                const masonryContainer = document.getElementById('masonry-container');

                // Clear container for fresh rendering
                masonryContainer.innerHTML = '';

                orders.forEach(order => {
                    // Create card structure
                    const colDiv = document.createElement('div');
                    colDiv.className = 'col';

                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card shadow-sm border-light rounded-3';

                    // Card header
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'card-header d-flex justify-content-between align-items-center p-3';

                    const headerLeft = document.createElement('div');
                    headerLeft.className = 'text-start';
                    headerLeft.innerHTML = `<h6 class="mb-0 fw-bold">${order.client_name}</h6>`;

                    const headerRight = document.createElement('div');
                    headerRight.className = 'text-end';
                    headerRight.innerHTML = `
                        <span class="badge custom-badge ${
                            order.order_status === 'Cooking' ? 'bg-success' :
                            order.order_status === 'Dispatched' ? 'bg-primary' :
                            order.order_status === 'Ready' ? 'bg-info' : 'bg-warning'
                        }">${order.order_status}</span>
                    `;

                    headerDiv.appendChild(headerLeft);
                    headerDiv.appendChild(headerRight);

                    // Card body with table
                    const cardBodyDiv = document.createElement('div');
                    cardBodyDiv.className = 'card-body p-2';

                    const tableContainer = document.createElement('div');
                    tableContainer.className = 'table-responsive';

                    const table = document.createElement('table');
                    table.className = 'table table-bordered mb-0';

                    const thead = document.createElement('thead');
                    thead.className = 'table-light';
                    thead.innerHTML = `
                        <tr>
                            <th class="text-center align-middle" style="padding: 0.5rem;">${order.meal_type}</th>
                            <th class="text-center text-muted small align-middle" style="padding: 0.5rem;">Order #: ${order.order_number}</th>
                        </tr>
                    `;

                    const tbody = document.createElement('tbody');

                    // Append items that match the order ID
                    items.forEach(item => {
                        if (item.order_id === order.id) {
                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                                <td class="text-center py-1 align-middle"><strong>${item.item_name}</strong></td>
                                <td class="text-center py-1 align-middle">
                                    ${item.quantity || 0}
                                    ${item.quantity_type === 'kilogram' ? 'Kg' :
                                      item.quantity_type === 'Numbers' ? 'Nos' :
                                      item.quantity_type === 'grams' ? 'G' : item.quantity_type || ''}
                                </td>
                            `;
                            tbody.appendChild(tr);
                        }
                    });

                    // Add COUNT row
                    const countRow = document.createElement('tr');
                    countRow.innerHTML = `
                        <td colspan="2" class="text-center fw-bold py-2">COUNT: <span>${order.total_pax_quantity || ' '}</span></td>
                    `;
                    tbody.appendChild(countRow);

                    table.appendChild(thead);
                    table.appendChild(tbody);
                    tableContainer.appendChild(table);
                    cardBodyDiv.appendChild(tableContainer);

                    // Assemble card
                    cardDiv.appendChild(headerDiv);
                    cardDiv.appendChild(cardBodyDiv);
                    colDiv.appendChild(cardDiv);
                    masonryContainer.appendChild(colDiv);
                });
            })
            .catch(error => console.error('Error loading data:', error));
    });
</script>


<!--    document.addEventListener('DOMContentLoaded', function () {-->
<!--    const orders = document.querySelectorAll('.order-card-item');-->
<!--    console.log("orders",orders)-->
<!--     orders.forEach(order => {-->
<!--        // Fetch the script tag containing the order id-->
<!--        const orderIdScript = document.getElementById(`order-${order.dataset.orderId}`);-->
<!--        console.log("orders",orders)-->
<!--        console.log("orderIdScript",orderIdScript)-->
<!--        console.log("orders",orders)-->

<!--    const container = document.querySelector('.masonry-grid');-->

<!--    // Initialize Masonry layout-->
<!--    const masonryInstance = new Masonry(container, {-->
<!--        itemSelector: '.col',-->
<!--        columnWidth: '.row',-->
<!--        percentPosition: true,-->
<!--    });-->

<!--    // Initial load of orders and items-->
<!--    loadOrdersAndItems(masonryInstance);-->

<!--    // Set interval to auto-refresh every 3 minutes (180000 ms) - currently 10 seconds for testing-->
<!--    setInterval(() => {-->
<!--        console.log("Refreshing orders and items...");-->
<!--        loadOrdersAndItems(masonryInstance);-->
<!--    }, 10000); // Change to 180000 ms for production-->

<!--    // Fetch and update order data-->
<!--    async function loadOrdersAndItems(masonryInstance) {-->
<!--        const storedOrders = JSON.parse(localStorage.getItem('orders')) || [];-->
<!--        const storedItems = JSON.parse(localStorage.getItem('items')) || [];-->

<!--        try {-->
<!--            const response = await fetch('Orders', {-->
<!--                headers: {-->
<!--                    'X-Requested-With': 'XMLHttpRequest',-->
<!--                    'Content-Type': 'application/json',-->
<!--                }-->
<!--            });-->
<!--            const data = await response.json();-->
<!--            const { items_json: item_response, orders: order_response } = data;-->

<!--            // Process orders-->
<!--            order_response.forEach(newOrder => {-->
<!--                const existingOrderIndex = storedOrders.findIndex(order => order.order_id === newOrder.order_id);-->

<!--                if (existingOrderIndex === -1) {-->
<!--                    storedOrders.push(newOrder);-->
<!--                    console.log(`Added new order:`, newOrder);-->
<!--                    addOrderCard(newOrder, item_response, masonryInstance);-->
<!--                } else {-->
<!--                    const existingOrder = storedOrders[existingOrderIndex];-->
<!--                    if (existingOrder.status !== newOrder.status || existingOrder.quantity !== newOrder.quantity) {-->
<!--                        storedOrders[existingOrderIndex] = newOrder;-->
<!--                        console.log(`Updated order:`, newOrder);-->
<!--                        updateOrderItems(newOrder, item_response, masonryInstance);-->
<!--                    }-->
<!--                }-->
<!--            });-->

<!--            // Process items-->
<!--            item_response.forEach(newItem => {-->
<!--                const existingItemIndex = storedItems.findIndex(item => item.item_id === newItem.item_id);-->
<!--                if (existingItemIndex === -1) {-->
<!--                    storedItems.push(newItem);-->
<!--                    console.log(`Added new item:`, newItem);-->
<!--                } else {-->
<!--                    const existingItem = storedItems[existingItemIndex];-->
<!--                    if (existingItem.name !== newItem.name || existingItem.quantity !== newItem.quantity) {-->
<!--                        storedItems[existingItemIndex] = newItem;-->
<!--                        console.log(`Updated item:`, newItem);-->
<!--                    }-->
<!--                }-->
<!--            });-->

<!--            // Update localStorage-->
<!--            localStorage.setItem("orders", JSON.stringify(storedOrders));-->
<!--            localStorage.setItem("items", JSON.stringify(storedItems));-->

<!--            // Refresh Masonry layout-->
<!--            masonryInstance.reloadItems();-->
<!--            masonryInstance.layout();-->
<!--        } catch (error) {-->
<!--            console.error("Error fetching or updating data:", error);-->
<!--        }-->
<!--    }-->

<!--    // Create order HTML structure-->
<!--    function createOrderHtml(order, items) {-->
<!--        const orderItems = items.filter(item => item.order_id === order.order_id);-->

<!--        return `-->
<!--            <div class="col-sm-6 col-md-4 col-lg-3 order-card-item" data-order-number="${order.order_number}">-->
<!--                <div class="card order-card shadow-sm border-light rounded-3">-->
<!--                    <div class="card-header d-flex justify-content-between align-items-center bg-dark text-white">-->
<!--                        <h6 class="mb-0">${order.client__name}</h6>-->
<!--                        <span class="badge ${order.order_status === 'Cooking' ? 'bg-success' : order.order_status === 'Dispatched' ? 'bg-danger' : 'bg-warning'}">-->
<!--                            ${order.order_status}-->
<!--                        </span>-->
<!--                    </div>-->
<!--                    <div class="card-body">-->
<!--                        <div class="row">-->
<!--                            <div class="col-6">-->
<!--                                <p class="mb-1 text-start"><strong>Meal:</strong> ${order.meal_type}</p>-->
<!--                            </div>-->
<!--                            <div class="col-6">-->
<!--                                <p class="mb-1 text-start"><strong>Order #:</strong> ${order.order_number}</p>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="row mb-3 order-items">-->
<!--                            ${orderItems.length > 0 ?-->
<!--                                orderItems.map(item => `-->
<!--                                    <div class="col-12">-->
<!--                                        <p class="mb-1 text-start">-->
<!--                                            <strong>${item.item__item_name || ''}</strong> - -->
<!--                                            <span>${item.quantity || ''} ${item.quantity_type || ''}</span>-->
<!--                                        </p>-->
<!--                                    </div>`-->
<!--                                ).join('') :-->
<!--                                '<p class="text-muted">No items available</p>'-->
<!--                            }-->
<!--                        </div>-->
<!--                        <div class="text-center mb-4">-->
<!--                            <p class="text-white bg-dark p-2 rounded">-->
<!--                                <strong>COUNT:</strong>-->
<!--                                <span class="text-white px-3 py-1 rounded">${order.total_pax_quantity || ''}</span>-->
<!--                            </p>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>`;-->
<!--    }-->

<!--    // Add order card to Masonry container-->
<!--    function addOrderCard(order, items, masonryInstance) {-->
<!--        const orderHtml = createOrderHtml(order, items);-->
<!--        const tempDiv = document.createElement('div');-->
<!--        tempDiv.innerHTML = orderHtml;-->
<!--        const newCard = tempDiv.firstElementChild;-->
<!--        container.appendChild(newCard);-->
<!--        masonryInstance.appended(newCard);-->
<!--        masonryInstance.reloadItems();-->
<!--        masonryInstance.layout();-->
<!--    }-->

<!--    // Update order items within existing card-->
<!--    function updateOrderItems(order, items, masonryInstance) {-->
<!--        var orderId = JSON.parse(document.getElementById("order_id").textContent);-->
<!--        console.log("Order ID: ", orderId);-->
<!--        const existingOrderElement = document.querySelector(`.order-card-item[data-order-id="${orderId}"]`);-->
<!--        if (existingOrderElement) {-->
<!--            const orderItems = items.filter(item => item.order_id === order.order_id);-->
<!--            existingOrderElement.innerHTML = orderItems.length > 0-->
<!--                ? orderItems.map(item => `-->
<!--                    <div class="col-12">-->
<!--                        <p class="mb-1 text-start">-->
<!--                            <strong>${item.item__item_name || ''}</strong> - -->
<!--                            <span>${item.quantity || ''} ${item.quantity_type || ''}</span>-->
<!--                        </p>-->
<!--                    </div>`).join('')-->
<!--                : '<p class="text-muted">No items available</p>';-->

<!--            masonryInstance.reloadItems();-->
<!--            masonryInstance.layout();-->
<!--        } else {-->
<!--            console.warn(`Order element with order number ${order.order_number} not found for update.`);-->
<!--        }-->
<!--    }-->
<!--});-->
</script>


</body>
</html>
